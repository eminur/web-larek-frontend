# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```
## Архитектура проекта (MVP)

Архитектура приложения спроектирована с использованием патерна MVP

### Базовый код

1.  **Класс EventEmitter**

Реализует паттерн «Наблюдатель» и позволяет подписываться на события и уведомлять подписчиков о наступлении события. 

Поля:

-   **\_events** - объект типа Map хранит callback функции на соответсвующие события

Методы:

-   **on** **(event, callback)** - устанавливает обработчик callback на событие event
-   **off (event, callback)** - снимает обработчик callback c события event
-   **emit (event, data)** - инициировать событие event с данными data
-   **onAll (callback)** - устанавливает обработчик callback на все события
-   **offAll ()** - сбросить все обработчики
-   **trigger (event, context)** - генерирует заданное событие event с заданными аргументами context

2.  **Класс Component\<T\>**

Базовый класс для реализации компонентов представления. Предоставляет методы для вывода элементов интерфейса, установки видимости и доступности, установки текстовых значении.

Поля:

-   **container** - базовый элемент контейнер типа HTMLElement куда монтируется HTML элементы пользовательской интерфейса

Методы:

-   **toggleClass (element: HTMLElement, className: string, force?:boolean)** - для включения/выключения CSS класса у HTML элемента element
-   **setText (element: HTMLElement, value: unknown)** - устанавливает текствое содержание у HTML элемента element
-   **setDisabled (element: HTMLElement, state: boolean)** - устанавливает значение атрибута disabled у HTML элемента element, установка статуса блокировки
-   **setHidden (element: HTMLElement)** - скрывает HTML элемент element
-   **setVisible (element: HTMLElement)** - показать HTML элемент element
-   **setImage(element: HTMLImageElement, src: string, alt?: string)** - устанавливает изображение с альтернативным текстом
-   **render (data)** - возвращает HTMLElement - контейнер с измененными свойствами элементов этого контейнера, значения свойств передается в параметре data

### Компоненты модели данных

1.  **Класс CatalogModel**

Реализует каталог товаров. Позволяет заполнять список товаров, получать список товаров, получать товар по идентификатору, получать общую сумму стоимости выбранных товаров.

Поля:

-   **items** - массив объектов товар

Методы:

-   **constructor(protected events: IEvents)** -конструктор принимает объект презентера events для генерации пользовательских событии
-   **setItems (items: IProductItem \[\])** - устанавливает список товаров и устанавливает событие "items:change"
-   **getItems (): IProductItem \[\]** - возвращает весь список товаров
-   **getItem (id: ProductId): IProductItem** - возвращает товар с индентификатором id
-   **getTotalPrice (ids: ProductId \[\]):number** - возвращает общую сумму стоимости товаров ids

2.  **Класс BasketModel**

Реализует корзину выбранных товаров. Позволяет добавлять товар, удалять
товар, получить общее количество товаров, очищать корзину.

Поля:

-   **items** - объект типа Map, хранит идентификаторы выбранных товаров
-   **totalPrice** - общая сумма стоимости товаров в корзине

Методы:

-   **constructor(protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии
-   **add (id: ProductId)** - добавляет идентификатор товара id в items и вызывает метод установки события \_changed()
-   **remove(id: ProductId)** - удаляет идентификатор товара id из items и вызывает метод установки события \_changed()
-   **\_changed()** - устанавливает событие "basket:change"


3.  **Класс OrderModel**

Объединяет части заказа, реализует композицию классов OrderInfo и OrderContact. Позволяет записывать и получать значения условии оплаты заказа, записывать и получать контактные данные, выполнять проверку валидности записываемых данных

Поля:

-   **\_errors** - массив строк, содержит текст ошибок при валидации
-   **orderInfo** - данные об условии оплаты и адреса
-   **orderContact** - контактные данные

Методы:

-   **constructor(protected events: IEvents)** -конструктор принимает объект презентера events для генерации пользовательских событии
-   **setOrderInfo (value: Partial\<IOrderInfo\>)** - устанавливает значения поля orderInfo, проверяет валидность заполняемых данных, формирует текст ошибок, устанавливает событие "orderInfo:change"
-   **getOrderInfo ():IOrderInfo** - возварщет значение поля orderInfo
-   **setOrderContact (value: Partial\<IOrderContact\>)** - устанавливает значения поля orderContact, проверяет валидность заполняемых данных, формирует текст ошибок, устанавливает событие "orderInfo:change"
-   **getOrderContact(): IOrderContact** - возвращет значение поля orderContact

### Компоненты представления

Все компоненты представления получены путем наследования от базового класса Component\<T\> и передачи в T соответствующего интерфейса компонента

1.  **Класс Page**

Выводить на главной страницу каталог товаров и количество товаров в корзине

Интерфейс определения свойств:

```Typescript
interface IPage {

    counter: number; // количество товаров в корзине

    gallery: HTMLElement\[\]; // массив карточек товаров каталога

    locked: boolean; // свойста блокировки прокрутки главной стриницы

}
```

Поля:

-   **\_counter** - HTML элемент содержит текст для вывода кол-во товаров в корзине
-   **\_gallery** - HTML элемент контейнер для вывода каталога товаров
-   **\_wrapper** - HTML элемент основной контейнер для вывода контента, обеспечивает прокрутку в зависимости от свойста locked
-   **\_basket** - HTML элемент кнопка для открытия окна корзины

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии, контейнер для вывода объекта этого класса

-   **set counter (value: number)** - сетер свойста counter, при установке изменяется текст элемента **\_counter**
-   **set gallery (items: HTMLElement\[\])** - сетер свойства gallery, принимает на вход массив HTML элементов, карточек товара и заменяет дочерние элементы контейнера **\_gallery**
-   **set locked (value: boolean)** - сетер свойства locked, дабавляет или убирает соответсвубщий CSS класс у элемента **\_warapper**

2.  **Класс Modal**

Модальное окно. Предоставляет контейнер для вывода компонентов карточек товара, форм заполнения заказа и вывода информации при успешной отправке заказа

Поля:

-   **\_closeButton** - HTML элемент кнопка закрытия окна
-   **\_content** - HTML элемент контейнер основного контент окна

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии,контейнер для вывода объекта этого класса
-   **set content(value: HTMLElement)** - сетер свойства content, при установке заменяется дочерние элементы поля **\_content**
-   **open ()** - открытие модально окна, генерируется событие "modal:open"
-   **close ()** - закрытие модального окна, генерируется событие "modal:close"
-   **render(data: IModalData): HTMLElement** - возвращает измененное представление

3.  **Класс Basket**

Выводит список товаров в корзине.

Интерфейс определения свойств:

```Typescript
interface IBasket {

totalPrice: number; // общая сумма стоимости выбранных товаров

basketItems: HTMLElement\[\];// массив карточек выбранных товаров

}
```

Поля:

-   **\_basketPrice** -HTML элемент, для отображения суммы стоимости товаров в корзине
-   **\_basketItems** - HTML элемент, список карточек товаров для корзины
-   **\_button** - HTML элемент кнопка для перехода на оформления покупки

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии, контейнер для вывода объекта этого класса

-   **set totalPrice(value: number)** - сетер свойста totalPrice, при установке изменяется текст элемента **\_basketPrice**
-   **set basketItems(items: HTMLElement\[\])** - сетер свойства basketItems, при установке заменяется дочерние элементы **\_basketItems**

4.  **Класс FormOrderInfo**

Выводит форму для заполнения данных о способе оплаты и адреса доставки заказа

Интерфейс определения свойств:

```Typescript
interface IFormOrderInfo {

  orderInfo: IOrderInfo; //объект с данными условии оплаты и адреса доставки

  errors: string\[\]; // тексты ошибок валидации

}
```

Поля:

-   **\_buttonCash** - HTML элемент кнопка для переключения способа оплаты в значение "При получении"
-   **\_buttonCard** - HTML элемент кнопка для переключения способаоплаты в значение "Онлайн"
-   **\_submit** - HTML элемент кнопка перехода на следующий этап оформления заказа
-   **\_address** - HTML элемент поле ввода адреса доставки
-   **\_errors** - HTML элемент для вывода текста ошибок валидации
-   **\_payment** - поле типа PaymentMethod, для хранения значения при переключения кнопок **\_buttonCash**, **\_buttonCard**

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии, контейнер для вывода объекта этого класса

-   **switchButton ()** - устанавливает сответсвующий CSS класс нажатой
    кнопки способа оплаты
-   **set errors(value: string\[\])** - сетер свойства errors, при установке изменяет текст элемента **\_errors** и устанавливает доступность кнопки **\_submit**
-   **set orderInfo(value: IOrderInfo)** - сетер свойства orderInfo,при установке изменяет значения свойства value у элемента **\_address,** значения поля **\_payment**, вызывается метод **switchButton ()**

5.  **Класс FormOrderContact**

Выводит форму для заполнения контактных данных заказа.

Интерфейс определения свойств:

```Typescript
interface IFormOrderContact {

orderContact: IOrderContact; // объект с контактными данными

errors: string\[\]; // тексты ошибок валидации

}
```

Поля:

-   **\_email** - HTML элемент для ввода email
-   **\_phone** - HTML элемент для ввода номера телефона
-   **\_errors** - HTML элемент для вывода текста ошибок валидации
-   **\_submit** - HTML элемент кнопка отправки заказа на сервер

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии,контейнер для вывода объекта этого класса
-   **set errors(value: string\[\])** - сетер свойства errors, при установке изменяет текст элемента **\_errors** и устанавливает доступность кнопки **\_submit**
-   **set orderContact(value: IOrderContact)** - сетер свойства orderContact, при установке изменяет значения свойств value у элементов **\_email** и **\_phone**

6.  **Класс Card**

Родительский класс карточек товара

Интерфейс определения свойств:

```Typescript
interface IProductItem {

id: ProductId; // идентификатор

description: string; // описание

image: string; // изображение

title: string; // наименование

category: ProductCategory; //категория

price: number \| null; // цена

}
```

Поля:

-   **\_title** - HTML элемента для вывода наименования товара
-   **\_price** - HTML элемент для вывода цены товара
-   **\_itemId** - поле для хранения идентификатора товара

Методы:

-   **constructor(container: HTMLElement)** - принимает контейнер куда выводится карточка
-   **set id(value: ProductId)** - сетер для установки свойства id, при установке изменяется значение поля **\_itemId**
-   **set title(value: string)** - сетер свойства title, при установке изменяет текст элемента **\_title**
-   **set price(value: number)** -сетер свойства price, при установке изменяет текст элемента **\_price**

7.  **Класс CardImage**

Родительский класс карточек товара с изображением, свою очередь наследуется от класcа **Card**

Поля:

-   **\_category** - HTML элемент для вывода категории товара
-   **\_image** - HTML элемент для вывода изображения товара

Методы:

-   **constructor(container: HTMLElement)** - принимает контейнер куда выводится карточка
-   **set category(value: ProductCategory)** - сетер свойства category,при установке изменяет текст элемента **\_category**
-   **set image(value: string)** - сетер свойства image, при установке устанавливает источник изображения элемента **\_image**

8.  **Класс CardCatalog**

Выводит карточку товара в каталог товаров. Наследуется от класса **СardImage**

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии, контейнер для вывода объекта этого класса

7.  **Класс CardPreview**

Выводит карточку выбранного товара. Наследуется от класса **СardImage**

Поля:

-   **\_button** - HTML элемент кнопка для добавления текущего товара в корзину

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии, контейнер для вывода объекта этого класса

8.  **Класс CardBasket**

Выводить карточку товара в список корзины. Наследуется от класса **Card**

Поля:

-   **\_index** - HTML элемент для вывода порядкового номера товара в корзине
-   **\_button** - HTML элемент для удаления товара из корзины

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии контейнер для вывода объекта этого класса
-   **set index(value: number)** - сетер для установки значения текста элемента **\_index**

9.  **Класс Success**

Выводить информации об успешной отправке заказа на сервер

Интерфейс определения свойств:

```Typescript
interface ISuccess {

  totalPrice: number;

}
```

Поля:

-   **\_totalPrice** - HTML элемента для вывода суммы заказа
-   **\_button** - HTML элемента кнопка для закрытия текущего окна

Методы:

-   **constructor(container: HTMLElement, protected events: IEvents)** - конструктор принимает объект презентера events для генерации пользовательских событии, контейнер для вывода объекта этого класса
-   **set totalPrice(value: number)** - сетер для установки свойства totalPrice, при установке изменяет текст элемента **\_totalPrice**

### Список пользовательских событий

-   **\'items:change\'** - изменения списка товаров в каталоге
-   **\'item:select\'** - выбран товар из каталога, на вход передается идентификатор товара
-   **\'item:addbasket\'** - добавление товара к корзину, на вход передается идентификатор товара
-   **\'item:deletebasket\'** - удаление товара из корзины, на вход передается идентификатор товара
-   **\'basket:open\'** - открытие корзины в модальном окне
-   **\'basket:change\'** - изменение содержимого корзины, возникает при добавлении или удалении товара. На вход передается массив идентификаторов товара
-   **\'basket:order\'** - переход на этап оформления заказа
-   **\'orderInfo:change\'** - изменения данных условии оплаты и адреса доставки заказа. На вход передается объект с данными и массив текстов ошибок валидации
-   **\'formOrderInfo:change\'** - изменения полей в форме оформления условии оплаты и адреса доставки заказа, на вход передается объект с изменёнными данными
-   **\'formOrderInfo:submit\'** - переход на следующий этап оформления заказа
-   **\'orderContact:change\'** - изменение контактных данных заказа На вход передается объект с данными и массив текстов ошибок валидации
-   **\'formOrderContact:change\'** - изменения полей в форме оформления контактных данных заказа, на вход передается объект с изменёнными данными
-   **\'formOrderContact:submit\'** - отправка заказа на сервер
-   **\'success:close\'** - закрытия окна об успешной отправке заказа на сервер
-   **\'modal:open\'** - открытия модального окна
-   **\'modal:close\'** - закрытия модального окна

### Ключевые типы данных

```typescript
//Идентификатор товара
export type ProductId = string; 

//Категории товаров
export type ProductCategory =
	| 'софт-скил'
	| 'хард-скил'
	| 'другое'
	| 'дополнительное'
	| 'кнопка';

 //Способ оплаты 
export enum PaymentMethod {
	CARD = 'online',
	CASH = 'при получении',
}

//Валюта 
export enum PriceCurrency {
	PRICLESS = 'Бесценно',
	SYNAPSESS = 'синапсов',
}

//Товар
export interface IProductItem {
	id: ProductId; 
	description: string; 
	image: string;
	title: string;
	category: ProductCategory;
	price: number | null;
}

// Контакты заказа
export interface IOrderContact {
	email: string;
	phone: string;
}

//Условие оплаты заказа
export interface IOrderInfo {
	payment: PaymentMethod; // способ оплаты
	address: string;  //адрес доставки
}

//Товары в заказе
export interface IOrderItems {
	total: number; //сумма заказа
	items: ProductId[]; //позиции заказа
}

//Заказ
export type Order = IOrderInfo & IOrderContact & IOrderItems;

//Результат отправки заказа на сервер
export interface IOrderResult {
	id?: string;
	total?: number;
	error?: string;
}

```
 
